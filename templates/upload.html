<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .upload-card {
            max-width: 600px;
            margin: 3rem auto;
            text-align: center;
        }
        #loading {
            display: none;
            margin: 1rem 0;
            color: #3498db;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 8px;
            color: white;
            z-index: 1000;
        }
        .toast.success {
            background: #2ecc71;
        }
        .toast.error {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="btn-home">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>

        <div class="card upload-card">
            <h1>üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π</h1>
            <form onsubmit="return uploadNewReading(this)" class="upload-form">
                <input type="file" name="file" accept="audio/*" required
                    class="custom-file-input" id="audioFile">
                <button type="submit" class="btn-main">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ</button>
                <div id="loading">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞...</div>
                <div id="result"></div>
            </form>
        </div>
    </div>

    <script>
        async function uploadNewReading(form) {
            const formData = new FormData(form);
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');
            const submitBtn = form.querySelector('button[type="submit"]');

            submitBtn.disabled = true;
            loading.style.display = 'block';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                showToast(data.message, response.ok ? 'success' : 'error');

                if(response.ok) {
                    form.reset();
                    setTimeout(() => window.location.href = '/records', 2000);
                }

            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
            return false;
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>